var Engine=function(){function e(t,n,r){if(!document.body)return void console.log(t);n||(n="S"),r||(r=3e3);var i=document.createElement("div"),o="padding:10px;margin:5px;border-radius: 3px;";switch(n){case"S":o+="color:#3c763d;background-color:#dff0d8;border-color:#d6e9c6;";break;case"I":o+="color: #31708f;background-color: #d9edf7;border-color: #9acfea;";break;case"W":o+="color: #8a6d3b;background-color: #fcf8e3;border-color: #f5e79e;";break;case"E":o+="color:#a94442;background-color:#f2dede;border-color:#ebccd1;";break;default:throw"Undefined message type: "+n}i.setAttribute("style",o),i.innerHTML=t,e.container.appendChild(i),null==e.container.parentNode&&document.body.appendChild(e.container),setTimeout(function(){i.remove(),""===e.container.innerHTML&&e.container.remove()},r)}function t(e,t){var n;if(n=null!==s.pathBuilder?s.findPath(e):"assets/js/"+e+".js",!n)throw"Can't load module "+e+" because path is undefined ";var r=document.createElement("script");r.onload=t,r.src=n,document.getElementsByTagName("head")[0].appendChild(r)}function n(e,t,n){if(i[e]="function"==typeof t?t.apply(window,n):t,a[e]&&a[e].deferredCallbacks)for(var r=a[e].deferredCallbacks.length-1;r>=0;r--)a[e].deferredCallbacks.pop()();if(o[e])for(var s=0;s<o[e].length;s++)o[e].pop()()}function r(e,n,o){if(s.limit--,s.limit<1)throw"Something wrong, too much modules in project! It look like circular dependency. Othervise, please change Engine.limit property";if(0===n.length)o();else{var u=n.pop(),l=function(){r(e,n,o)};l.toString=function(){return"Callback for "+e},a[u]?i[u]?l():-1===a[u].callers.indexOf(e)&&(a[u].callers.push(e),a[u].deferredCallbacks.push(l)):(a[u]={afterLoad:l,callers:[],deferredCallbacks:[]},t(u,function(){s.log&&s.notify("Script "+u+" was loaded as dependency for: "+e,"S"),a[u].afterLoad()}))}}var i={},o={},a={};e.container=document.createElement("div"),e.container.setAttribute("style","position: fixed; right: 0; top: 0; width: 200px;");var s={pathBuilder:null,limit:500,log:!0,modules:{},load:function(e,n){i[e]?n():(o[e]||(o[e]=[]),o[e].push(n),t(e))},define:function(e,t,o){if(!o)return void n(e,t,[]);t||(t=[]);var a,u=[];if(t)if("string"==typeof t)i[t]||u.push(t);else for(a=0;a<t.length;a++)void 0===i[t[a]]&&u.push(t[a]);if(u.length>0){var l=function(){s.define(e,t,o)};l.toString=function(){return"Callback for "+e+" when all dependencies resolved"},r(e,u,l)}else{var p=[];if(t)if("string"==typeof t)p=[s.require(t)];else for(a=0;a<t.length;a++)p.push(s.require(t[a]));n(e,o,p)}},require:function(e){if(void 0===i[e])throw"Module not instantiated "+e;return i[e]},notify:function(t,n,r){new e(t,n,r)},findPath:function(e){var t;if("function"==typeof s.pathBuilder){if(t=s.pathBuilder(e))return t}else for(var n=0;n<s.pathBuilder.length;n++){var r=s.pathBuilder[n];if(t=r.buildPath(e))return t}throw"Can't find module "+e}};return s}();Engine.define("Ajax",function(){function e(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])}var t={headers:null};return t.ajax=function(n,r,i){var o=t.getXhr();return o.open(n.type,n.url,!0),e(o,t.headers),e(o,n.headers),o.onload=function(){o.status>199&&o.status<300?r(t.process(o,n.responseType),o):i&&i(o)},o.send(n.data),o},t.process=function(e,t){var n=e.responseText;return"text"!==t&&n?JSON.parse(e.responseText):n},t.getXhr=function(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){alert("Hey man, are you using browser?")}}}return e},t}),Engine.define("Rest","Ajax",function(){var e=Engine.require("Ajax"),t={host:null};return t.doGet=function(e,n){return t._onRequest(e,"get",null,n)},t.doPost=function(e,n,r){return t._onRequest(e,"post",n,r)},t.doPut=function(e,n,r){return t._onRequest(e,"put",n,r)},t.doDelete=function(e,n,r){return t._onRequest(e,"delete",n,r)},t._onRequest=function(n,r,i,o){return null!==t.host&&(n=t.host+n),new Promise(function(t,a){e.ajax({responseType:o?o:"json",type:r,url:n,data:"string"==typeof i||"number"==typeof i?i:JSON.stringify(i)},t,a)})},t}),Engine.define("Word",["Rest"],function(){var e=Engine.require("Rest"),t={},n=!1,r=function(e,t,n,i){i||"string"!=typeof n||(i=n,n=t,t="default"),i||(i="text"),"string"==typeof t||n||(n=t,t="default");var o=function(r){n.getAttribute("data-w-key")!==e&&n.setAttribute("data-w-key",e),n.getAttribute("data-w-module")!==t&&n.setAttribute("data-w-module",t),n.getAttribute("data-w-strategy")!==i&&n.setAttribute("data-w-strategy",i),"text"!=i?"append"==i?n.appendChild(document.createTextNode(r)):n.innerHTML=r:n.innerText=r};r.languageLoaded(r.language)?o(r.get(e,t)):r.loadLanguage(r.language,function(){o(r.get(e,t))})};return r.dictionaries={},r.dictionariesPath="assets/js/word/",r.get=function(e,t,n){n||(n=r.language),t||(t="default");var i=r.dictionaries[n];if(i){var o=i[t]||i["default"]||{};return void 0!==o[e]?o[e]:(t?t:"default")+":"+e}return null},r.languageLoaded=function(e){return e||(e=r.language),void 0!==r.dictionaries[e]},r.loadLanguage=function(i,o){return"function"!=typeof i||o?i||(i=r.language):(o=i,i=r.language),t[i]?void("function"==typeof o?t[i].push(o):t[i]=t[i].concat(o)):(t[i]="function"==typeof o?[o]:o,void(r.loader?r.loader(i,t[i]):e.doGet(r.dictionariesPath+i+".json").then(function(e){var n={};for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];"string"==typeof a?(n.default||(n.default={}),n.default[o]=a):n[o]=a}r.dictionaries[i]=n,r.language=i;for(var s=0;s<t[i].length;s++)t[i][s]()},function(){n?Engine.notify("Can't load language - "+i,"E"):(n=!0,r.loadLanguage("en",t[i]),delete t[i])})))},r.translate=function(e,t){function n(){for(var e=t.getElementsByClassName("word"),n=0;n<e.length;n++){var i=e[n],o=i.getAttribute("data-w-key"),a=i.getAttribute("data-w-module"),s=i.getAttribute("data-w-strategy");o&&r(o,a,i,s)}}e||(e=r.language),t||(t=document.body),r.languageLoaded(e)?(r.language=e,n()):r.loadLanguage(e,n)},r.create=function(e,t){var n=function(n,i,o,a){return"string"!=typeof i&&(o=i,i=null),r(n,i||e,o||t,a)};return n.get=function(t,n){return r.get(t,e,n)},n.languageLoaded=r.languageLoaded,n.loadLanguage=r.loadLanguage,n.translate=r.translate,n},r.language=navigator.language||navigator.userLanguage||"en",r}),Engine.define("Config",function(){function e(e){this.configName=e;try{this.storage=JSON.parse(localStorage.getItem(e))}catch(t){this.storage=null}null==this.storage&&(this.storage={})}return e.prototype.get=function(e){return this.storage[e]},e.prototype.has=function(e){return void 0!==this.get(e)},e.prototype.set=function(e,t){this.storage[e]=t,localStorage.setItem(this.configName,JSON.stringify(this.storage))},e.prototype.remove=function(e){delete this.storage[e],localStorage.setItem(this.configName,JSON.stringify(this.storage))},e.prototype.toString=function(){return"Config instance"},e}),Engine.define("Dom",function(){function e(e,t,n){for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],o=0===r.indexOf("on")?r.substring(2):r;if("function"==typeof i)n(e,o,i);else for(var a=0;a<i.length;a++)n(e,o,i[a])}}void 0!==typeof Element&&(Element.prototype.isDomElement=!0),void 0!==typeof HTMLElement&&(HTMLElement.prototype.isDomElement=!0);var t={};return t.el=function(e,n,r){var i=document.createElement(e);return t.update(i,n),t.append(i,r),i},t.addClass=function(e,t){e.className?-1===e.className.indexOf(t)?e.className+=" "+t:-1===e.className.split(" ").indexOf(t)&&(e.className+=" "+t):e.className=t},t.removeClass=function(e,t){var n=e.className;if(n&&n.indexOf(t)>-1){var r=n.split(" "),i=r.indexOf(t);i>-1&&(r.splice(i,1),e.className=r.join(" "))}},t.hasClass=function(e,t){var n=e.className;return n.indexOf(t)>-1?n.split(" ").indexOf(t)>-1:!1},t.id=function(e){return document.getElementById(e)},t.update=function(e,t){if("string"==typeof t)e.className=t;else if(t)for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if("function"==typeof t[n]){var i=n;0===i.indexOf("on")&&(i=i.substring(2)),e.addEventListener(i,r)}else"value"===n?e.value=r:e.setAttribute(n,r)}},t.append=function(e,n){if(n)if("string"==typeof n||"number"==typeof n)e.appendChild(document.createTextNode(n+""));else if(n.length&&n.push&&n.pop)for(var r=0;r<n.length;r++){var i=n[r];i&&t.append(e,i)}else if(n.isDomElement)e.appendChild(n);else{if(!n.container)throw"Can't append object";t.append(e,n.container)}},t.addListeners=function(t,n){n||(n=t,t=window),e(t,n,function(e,t,n){e.addEventListener(t,n,!1)})},t.removeListeners=function(t,n){n||(n=t,t=window),e(t,n,function(e,t,n){e.removeEventListener(t,n,!1)})},t.calculateOffset=function(e){var t=0,n=0;if(e.getBoundingClientRect){var r=e.getBoundingClientRect(),i=document.body,o=document.documentElement,a=window.pageYOffset||o.scrollTop||i.scrollTop,s=window.pageXOffset||o.scrollLeft||i.scrollLeft,u=o.clientTop||i.clientTop||0,l=o.clientLeft||i.clientLeft||0;return t=r.top+a-u,n=r.left+s-l,{top:Math.round(t),left:Math.round(n)}}for(;e;)t+=parseInt(e.offsetTop),n+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:n}},t.insert=function(e,n,r){if(""===e.innerHTML)return void t.append(e,n);if(r||(r=e.childNodes[0]),n)if("string"==typeof n||"number"==typeof n)e.insertBefore(document.createTextNode(n+""),r);else if(n.length&&n.push&&n.pop)for(var i=0;i<n.length;i++){var o=n[i];o&&t.insert(e,o,r)}else if(n.isDomElement)e.insertBefore(n,r);else{if(!n.container)throw"Can't inesert object";t.insert(e,n.container,r)}},t.animate=function(e,n,r,i,o,a){a||(a=0),i||(i=10);var s=function(e,t,n,r){var i=[];for(var o in t)if(t.hasOwnProperty(o)){var a=e.style[o];a||0===a||(a=getComputedStyle(e)[o]),a?a=parseInt(a):(e.style[o]=0,a=0);var s=t[o];!function(t,n,o){e.style[t]=n+"px",i.push(setInterval(function(){n+=o,e.style[t]=n+"px"},r))}(o,a,(s-a)*r/n)}setTimeout(function(){for(var e=0;e<i.length;e++)clearInterval(i[e])},n)};return setTimeout(function(){s(e,n,r,i,o)},a),a+=r,{animate:function(e,n,r,i,o){return t.animate(e,n,r,i,o,a)},then:function(e){setTimeout(function(){e()},a)}}},t}),Engine.define("KeyboardUtils",{translateButton:function(e){switch(e){case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"ctrl";case 18:return"alt";case 20:return"caps lock";case 27:return"esc";case 32:return"space";case 33:return"pg up";case 34:return"pg dn";case 35:return"end";case 36:return"home";case 37:return"ar left";case 38:return"ar top";case 39:return"ar right";case 40:return"ar bottom";case 45:return"ins";case 46:return"del";case 91:return"super";case 96:return"num 0";case 97:return"num 1";case 98:return"num 2";case 99:return"num 3";case 100:return"num 4";case 101:return"num 5";case 102:return"num 6";case 103:return"num 7";case 104:return"num 8";case 105:return"num 9";case 106:return"*";case 107:return"+";case 109:return"-";case 111:return"/";case 112:return"f2";case 113:return"f3";case 114:return"f4";case 115:return"f5";case 116:return"f6";case 117:return"f7";case 119:return"f8";case 120:return"f9";case 121:return"f10";case 122:return"f11";case 123:return"f12";case 144:return"num lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"~";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"'";default:return String.fromCharCode(e)}}}),Engine.define("ScreenUtils",{window:function(){var e=window,t="inner";return t+"Width"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},monitor:function(){return{width:outerWidth,height:outerHeight}}}),Engine.define("StringUtils",function(){var e=/([a-z])([A-Z])/g,t=/^(\/)|(\/)$/g,n=/\_/g,r=/\-/g,i={unique:function(e){return Math.random().toString(36).substring(2,e?e+2:7)},removeSlashes:function(e){return e.replace(t,"")},capitalize:function(e){return e?e[0].toUpperCase()+e.substring(1):e},normalizeText:function(t,o){if(void 0===o&&(o=" "),t||(t=""),t.indexOf("_")>-1&&(t=t.replace(n," ")),t.indexOf("-")>-1&&(t=t.replace(r," ")),t.match(e)&&(t=t.replace(e,"$1 $2")),t.indexOf(" ")>-1){for(var a=t.split(" "),s="",u=0;u<a.length;u++)a[u]&&(s+=i.capitalize(a[u])+(u!==a.length-1?o:""));return s}return i.capitalize(t)}};return i}),Engine.define("UrlUtils","StringUtils",function(){var e=Engine.require("StringUtils"),t={getPath:function(t){var n=e.removeSlashes(document.location.pathname);return t?n.split("/")[t-1]:n},getQuery:function(e){var t=document.location.search.replace(QUESTION_CHAR,""),n=t.split("&");if(n.length>0)for(var r=e+"=",i=0;i<n.length;i++){if(0===n[i].indexOf(r))return decodeURIComponent(n[i].substring(r.length));if(n[i]===r||n[i]===e)return""}return null},appendQuery:function(e,n){var r=t.getPath(),i=t.getQuery(e);e=encodeURIComponent(e);var o=e+"=",a=n||0===n?o+encodeURIComponent(n):e,s=document.location.search;if(null===i&&""===s)s="?"+a;else{var u=s.replace(/^\?/,"").split("&"),l=!1;if(s.indexOf(e)>-1)for(var p=u.length-1;p>=0;p--)if(0===u[p].indexOf(o)||u[p]===e){u[p]=a,l=!0;break}l||u.push(a),s="?"+u.join("&")}history.push(r+s)},removeQuery:function(e){if(e){var n=document.location.search.replace(QUESTION_CHAR,""),r=n.split("&");if(r.length>0)for(var i=e+"=",o=0;o<r.length;o++)if(0===r[o].indexOf(i)||r[o]===e){r.splice(o,1);var a=t.getPath();history.push(a+(r.length?"?"+r.join("&"):""));break}}}};return t}),Engine.define("Tabs",["Dom"],function(e){var t=function(){this.header=e.el("div","tabs-header"),this.content=e.el("div","tabs-body"),this.container=e.el("div","tabs",[this.header,this.content]),this.tabs=[]};return t.prototype.addTab=function(t,n){var r=!this.tabs.length,i={title:e.el("a",{href:"#","class":"tab-name "+(r?"active":"")},t),body:e.el("div","tab-content"+(r?"":" hidden"),n)};this.tabs.push(i);var o=this;return i.title.onclick=function(t){t.preventDefault();for(var n=0;n<o.tabs.length;n++)e.addClass(o.tabs[n].body,"hidden"),e.removeClass(o.tabs[n].title,"active");e.removeClass(i.body,"hidden"),e.addClass(i.title,"active")},this.header.appendChild(i.title),this.content.appendChild(i.body),this.tabs.length-1},t.prototype.removeTab=function(e){var t=this.tabs.splice(e,1);t.title.remove(!0),t.body.remove(!0)},t}),Engine.define("Pagination",["Dom"],function(e){var t=function(t,n){if(!t||!n)throw"Pagination instantiation error";var r=this;this.refreshButton=e.el("input",{type:"button",value:"Refresh"}),this.refreshButton.onclick=function(e){r.refresh(e)},this.page=e.el("input",{type:"text",value:n}),this.page.onkeyup=function(e){r.onChange(e)},this.pageNumber=n,this.onOpenPage=t,this.previousButton=e.el("input",{type:"button",value:"Previous page"}),this.previousButton.onclick=function(e){r.previous(e)},this.nextButton=e.el("input",{type:"button",value:"Next page"}),this.nextButton.onclick=function(e){r.next(e)},this.container=e.el("form",{"class":"pagination"},[this.refreshButton,this.previousButton,this.page,this.nextButton]),this.container.onsubmit=function(e){r.refresh(e)}};return t.prototype.refresh=function(e){e&&e.preventDefault(),this.openPage(this.pageNumber)},t.prototype.previous=function(e){e&&e.preventDefault(),this.openPage(this.pageNumber>1?this.pageNumber-1:1)},t.prototype.next=function(e){e&&e.preventDefault(),this.openPage(this.pageNumber+1)},t.prototype.openPage=function(e){this.pageNumber=e,this.page.value=e,this.onOpenPage(e)},t.prototype.regexp=/^\d*$/,t.prototype.onChange=function(){this.regexp.test(this.page.value)?(this.pageNumber=parseInt(this.page.value),this.openPage(this.pageNumber)):this.page.value=this.pageNumber},t}),Engine.define("Popup",["Dom","ScreenUtils"],function(){function e(e){e=e||{};var n=this;this.title=t.el("div",null,e.title),this.isOpen=e.isOpen||!1,this.minimized=e.minimized||!1,this.withOverlay=e.withOverlay!==!1,this.drag={active:!1,x:0,y:0,mx:0,my:0},this.width=0,this.height=0,this.listeners={onmousemove:function(e){n.onMouseMove(e)},onkeyup:function(e){n.onKeyUp(e)}},this.initHeader(e),this.body=t.el("div","panel-body"+(this.minimized?" minimized":""),e.content),this.container=t.el("div",{"class":"Popup panel"},[this.header,this.body]),e.isOpen&&this.show()}var t=Engine.require("Dom"),n=Engine.require("ScreenUtils"),r=1e3,i="position:fixed;z-index"+r+";left:0;top:0;width:100%;height:100%;background: rgba(0,0,0,0.4)",o=t.el("div",{style:i}),a=!1,s=0;return e.prototype.initHeader=function(e){var n=t.el("div","control-buttons",[e.controlMinimize===!1?null:t.el("button",{"class":"success small Popup-minimize",onclick:function(){i.minimized?t.removeClass(i.container,"minimized"):t.addClass(i.container,"minimized"),i.minimized=!i.minimized}},t.el("span",null,"_")),e.controlClose===!1?null:t.el("button",{"class":"danger small Popup-close",onclick:function(){i.hide()}},t.el("span",null,"x"))]),r=[n,this.title];this.header=t.el("div","panel-heading",r);var i=this;t.addListeners(this.header,{onmousedown:function(e){e&&(e.preventBubble=!0,e.stopPropagation(),e.preventDefault()),i.onDragStart(e)},onmouseup:function(e){e&&(e.preventBubble=!0,e.stopPropagation(),e.preventDefault()),i.onDragEnd()}})},e.prototype.onMouseMove=function(e){if(this.drag.active){var t=document.body,r=this.drag.x+(e.clientX-this.drag.mx+t.scrollLeft),i=this.drag.y+(e.clientY-this.drag.my+t.scrollTop);this.container.style.left=r+"px",this.container.style.top=i+"px";var o=n.window(),a=this.container.offsetWidth;a+r>o.width&&(this.container.style.left=o.width-a+"px");var s=this.container.offsetHeight;s+i>o.height&&(this.container.style.top=o.height-s+"px")}},e.prototype.onDragEnd=function(){this.drag.active=!1},e.prototype.onDragStart=function(e){if(!this.drag.active){this.drag.active=!0;var t=this.container.style;this.drag.x=t.left?parseInt(t.left):0,this.drag.y=t.top?parseInt(t.top):0;var n=document.body;this.drag.mx=e.clientX+n.scrollLeft,this.drag.my=e.clientY+n.scrollTop}},e.prototype.show=function(){this.withOverlay&&!a&&document.body.appendChild(o),s++,this.container.style.zIndex=++r,document.body.appendChild(this.container),t.addListeners(this.listeners),this.isOpen||(this.isOpen=!0,this.container.style.top=document.body.scrollTop+30+"px",this.container.style.left=(n.window().width-this.container.offsetWidth)/2+"px")},e.prototype.setContent=function(e){this.body.innerHTML="",t.append(this.body,e)},e.prototype.setTitle=function(e){this.title.innerHTML="",t.append(this.title,e)},e.prototype.onKeyUp=function(e){this.isOpen&&27==e.keyCode&&(e.preventDefault(),this.hide())},e.prototype.hide=function(){s--,this.isOpen=!1,0>s&&(s=0),0===s&&o.remove(),this.container.remove(),t.removeListeners(this.listeners)},e.getParams=function(){return{isOpen:!1,minimized:!1,content:null,title:null,controlClose:!0,controlMinimize:!0,withOverlay:!0}},e}),Engine.define("Menu",["Dom","StringUtils"],function(e,t){function n(t,n){this.container=e.el("div",n||"menu"),this.defaultCallback=t,this.menus=[]}return n.prototype.hide=function(){e.addClass(this.container,"hidden")},n.prototype.show=function(){e.removeClass(this.container,"hidden")},n.prototype.deactivateAll=function(){for(var t=0;t<this.menus.length;t++)e.removeClass(this.menus[t],"active")},n.prototype.menu=function(n,r,i,o){var a=this;"function"!=typeof r||i||(i=r,r=null),n&&!r&&(r=t.normalizeText(n)),!i&&this.defaultCallback&&(i=this.defaultCallback);var s=null,u=e.el("div","menu-item");this.menus.push(u);var l=function(t){o?o(t):(t&&t.preventDefault(),a.deactivateAll()),e.addClass(u,"active")};if(n){var p={href:"/"+n};p.onclick=function(e){l(e),i&&i(n,e)},s=e.el("a",p,r),u.appendChild(s),t.removeSlashes(n)===t.removeSlashes(document.location.pathname)&&l()}var c=null;return this.container.appendChild(u),{menu:function(e,t,n){return a.menu(e,t,n,l)},subMenu:function(t,n,r){var i=a.menu(t,n,r,l);null===c&&(c=e.el("ul"),u.appendChild(c));var o=i.activate;return i.activate=function(e){l(e),o(e)},i.link&&e.addListeners(i.link,{onclick:l}),c.appendChild(e.el("li","submenu",i.item)),i},item:u,link:s}},n}),Engine.define("Grid",["Dom","Pagination","StringUtils"],function(){function e(e){var r=this;if(this.header=t.el("thead"),this.body=t.el("tbody"),this.footer=t.el("tfoot"),!e.columns)throw"columns is required parameter for grid";var i={};this.params=e,e.class&&(i.class=e.class),e.id&&(i.id=e.id),this.table=t.el("table",null,[this.header,this.body,this.footer]),this.data=e.data?e.data:[];var o=null;e.onOpenPage&&(this.pagination=new n(function(t){e.onOpenPage(t).then(function(e){r.data=e.data,r.update()})},e.page||1),o=this.pagination.container,this.pagination.refresh()),this.fullUpdate(),this.container=t.el("div",null,[o,this.table])}var t=Engine.require("Dom"),n=Engine.require("Pagination"),r=Engine.require("StringUtils");return e.prototype.buildRow=function(e){if(this.params.rowRender)return this.params.rowRender(e);var n=e%2?"odd":"even";return t.el("tr",n)},e.prototype.fullUpdate=function(){this.update();var e=this.params;e.class&&t.addClass(this.container,this.params.class),e.id&&t.update(this.container,{id:e.id}),this.header.innerHTML="",this.footer.innerHTML="";for(var n=t.el("tr"),i=t.el("tr"),o=0;o<this.params.columns.length;o++){var a=this.params.columns[o],s=a.title||r.normalizeText(a.name);t.append(n,t.el("th",null,s)),a.footer&&t.append(i,a.footer)}this.header.appendChild(n),i.innerHTML&&this.footer.appendChild(i)},e.prototype.update=function(){this.body.innerHTML="";for(var e=this.params.columns,n=this.data,r=0;r<n.length;r++){for(var i=this.buildRow(r),o=0;o<e.length;o++){var a=e[o],s=n[r][a.name];a.render?t.append(i,t.el("td",a.class,a.render(s,n[r]))):t.append(i,t.el("td",a.class,s))}t.append(this.body,i)}},e}),Engine.define("AbstractInput",["Dom","StringUtils"],function(e,t){function n(t){if(!t.name)throw"Name is reqired for input";this.input=e.el(this.getElementType(),this.prepareAttributes(t),this.prepareContent(t)),this.label=this.buildLabel(t),this.container=e.el("div","formfield-holder "+(t.class||""),[this.label,this.input]),this.errors=null,this.errorsData=null}return n.prototype.removeErrors=function(e){var t={};if(this.errorsData&&e){"string"==typeof e&&(e=[e]);for(var n in this.errorsData)this.errorsData.hasOwnProperty(n)&&-1===e.indexOf(n)&&(t[n]=this.errorsData[n])}this.errorsData={},this.addError(t)},n.prototype.addError=function(t){if(null===this.errors?(this.errors=e.el("div","formfield-errors"),this.container.appendChild(this.errors),this.errorsData={}):this.errors.innerHTML="","string"==typeof t)this.errorsData.custom=t;else for(var n in t)t.hasOwnProperty(n)&&(this.errorsData[n]=t[n]);var r={};for(var i in this.errorsData)this.errorsData.hasOwnProperty(i)&&this.errorsData[i]&&(r[i]=e.el("div","err",this.errorsData[i]),this.errors.appendChild(r[i]));return r},n.prototype.buildLabel=function(n){var r;r=n.noLabel===!0?null:n.label?n.label:t.normalizeText(n.name);var i={"for":this.input.id};return e.el("label",i,r)},n.prototype.getInputType=function(){throw"This function must be overrided"},n.prototype.getElementType=function(){throw"This function must be overrided"},n.prototype.prepareContent=function(){return null},n.prototype.prepareAttributes=function(e){var n={value:e.value||"",name:e.name,type:this.getInputType(),id:e.id||t.unique()};if(null===n.type&&delete n.type,e.attr)for(var r in e.attr)e.attr.hasOwnProperty(r)&&(n[r]=e.attr[r]);for(var i in e)e.hasOwnProperty(i)&&"function"==typeof e[i]&&(n[i]=e[i]);return n},n.prototype.getValue=function(){return this.input.value},n.prototype.setValue=function(e){this.input.value=e},n}),Engine.define("Checkbox",["Dom","AbstractInput"],function(e,t){function n(){t.apply(this,arguments),e.append(this.container,[this.input,this.label]),this.input.checked=this._checked,delete this._checked}return n.prototype=Object.create(t.prototype),n.prototype.getElementType=function(){return"input"},n.prototype.getInputType=function(){return"checkbox"},n.prototype.getValue=function(){return this.input.checked},n.prototype.setValue=function(e){this.input.checked=e},n.prototype.prepareAttributes=function(e){var n=t.prototype.prepareAttributes.apply(this,arguments);return this._checked=!!e.value,delete n.value,n},n.prototype.toString=function(){return"Radio("+this.input.name+")"},n.toString=function(){return"Radio"},n.prototype.constructor=n,n}),Engine.define("FieldMeta",function(){function e(e){e||(e={}),this.ignore=e.ignore||!1,this.render=e.render||null,this.wrapper=e.wrapper||null,this.contentBefore=e.contentBefore||null,this.contentAfter=e.contentAfter||null,this.listeners=e.listeners||null,this.validations=e.validations||null,this.removeErrors=e.removeErrors||null,this.errorMessages=e.errorMessages||null,this.options=e.options||null,this.type=e.type||"text",this.label=e.label||null,this.wordKey=e.wordKey||null,this.wordErrorKey=e.wordErrorKey||null}return e}),Engine.define("Text",["Dom","AbstractInput"],function(e,t){function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.getElementType=function(){return"input"},n.prototype.getInputType=function(){return"text"},n.prototype.toString=function(){return"Text("+this.input.name+")"},n.toString=function(){return"Text"},n.prototype.constructor=n,n}),Engine.define("Select",["Dom","AbstractInput"],function(e,t){function n(e){t.apply(this,arguments),this.params=e,this.options=e.options,this.update(e.value)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.update=function(){this.input.innerHTML="";for(var t=0;t<this.options.length;t++){var n=this.options[t],r=e.el("option",{value:n.value},n.label);e.append(this.input,r)}},n.prototype.getElementType=function(){return"select"},n.prototype.getInputType=function(){return null},n.prototype.toString=function(){return"Select("+this.input.name+")"},n.toString=function(){return"Select"},n}),Engine.define("Radio",["Dom","AbstractInput"],function(e,t){function n(n){t.apply(this,arguments),this.input.remove(),delete this.input,this.params=n,this.options=n.options,this.inputs=null,this.optionsContainer=e.el("div"),this.update(n.value),this.container.appendChild(this.optionsContainer),e.insert(this.label,this.input)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.update=function(t){this.optionsContainer.innerHTML="",this.inputs=[];for(var n=this.params.name,r=0;r<this.options.length;r++){var i=this.options[r],o=e.el("input",{type:"radio",id:n+"_"+i.value,name:n,value:i.value});(i.value===this.getValue()||i.value===t)&&(o.checked=!0);var a={};for(var s in this.params)this.params.hasOwnProperty(s)&&0===(s+"").indexOf("on")&&"function"==typeof this.params[s]&&(a[s]=this.params[s]);e.addListeners(o,a),this.inputs.push(o),this.optionsContainer.appendChild(e.el("label",{"for":n+"_"+i.value},[o,i.label]))}},n.prototype.getElementType=function(){return"input"},n.prototype.getInputType=function(){return""},n.prototype.getValue=function(){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].checked)return this.inputs[e].value;return""},n.prototype.toString=function(){return"Radio("+this.input.name+")"},n.toString=function(){return"Radio"},n}),Engine.define("Password",["Dom","AbstractInput"],function(e,t){function n(n){t.apply(this,arguments),this.showChars=n.showChars||!1;var r=this;this.toggler=e.el("a",{href:"#",onclick:function(e){e.preventDefault(),r.toggleInput()}},[this.getTogglerContent()]),this.container.appendChild(this.toggler)}return n.prototype=Object.create(t.prototype),n.prototype.getElementType=function(){return"input"},n.prototype.toggleInput=function(){this.showChars=!this.showChars,this.input.type=this.getInputType(),this.toggler.innerHTML=this.getTogglerContent()},n.prototype.getTogglerContent=function(){return this.showChars?"Hide":"Show"},n.prototype.getInputType=function(){return this.showChars?"text":"password"},n.toString=function(){return"Password"},n.prototype.constructor=n,n}),Engine.define("Textarea",["Dom","AbstractInput"],function(e,t){function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.getElementType=function(){return"textarea"},n.prototype.getInputType=function(){return null},n.toString=function(){return"Textarea"},n.prototype.constructor=n,n}),Engine.define("Validation",function(){function e(e){if("string"==typeof e){if(void 0===n[e]){for(var t=e.split(" "),r={},i=0;i<t.length;i++){var o=t[i].split(":"),a=o.shift();r[a]=o}n[e]=r}e=n[e]}else if(!Array.isArray(e))for(var s in e)e.hasOwnProperty(s)&&!Array.isArray(e[s])&&(e[s]=[e[s]]);return e?e:{}}var t=/^([a-zA-Z0-9_.+-])+\@(([cd a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,n={},r={validate:function(t,n){n=e(n);var i=[];for(var o in n){if(!n.hasOwnProperty(o)||!r.rules.hasOwnProperty(o))throw"Unknown validation rule: "+o+". Please use one of the following: "+Object.keys(r.rules);var a=r.rules[o].apply(r.rules,[].concat(t,n[o]));a||i.push(o)}return i},messages:{required:"Can't be empty.",max:"Number is too large.",min:"Number is too small.",length:"This is not valid length.",email:"Invalid email address",number:"Value is not a number",positive:"Value is not a positive number",negative:"Value is not a negative number",time:"Invalid time format",dateString:"Invalid date format.",timeString:"Invalid time format, must be hh:mm:ss.","default":"Something wrong."},rules:{required:function(e,t){if(!e)return!1;if("lazy"===t)return"0"===e||e.trim&&""===e.trim()?!1:!!e;if("checkboxes"===t){for(var n in e)if(e.hasOwnProperty(n)&&e[n])return!0;return!1}return!!e},max:function(e,t){return e||(e=0),parseInt(e)<=t},min:function(e,t){return e||(e=0),parseInt(e)>=t},length:function(e,t,n){return e||(e=""),(void 0===n?!0:e.length<=n)&&e.length>=t},pattern:function(e,t){return t.test(e)},number:function(e){return e?r.rules.pattern(e,/^(-?\d*)$/g):!0},positive:function(e){return r.rules.pattern(e,/^(\d*)$/g)},negative:function(e){return r.rules.pattern(e,/^(-\d*)$/g)},email:function(e){return r.rules.pattern(e,t)},time:function(e){if(!e)return!0;var t=/^([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/;return t.test(e)},custom:function(e,t){return t(e)}}};return r}),Engine.define("UrlResolver",["StringUtils"],function(e){function t(e){this.mapping=[],this.strategy=e||"path"}return t.prototype.resolve=function(t){t=e.removeSlashes(t),""===t&&(t="home");for(var n,r=this.mapping,i=t.split("/"),o=null,a=0;a<r.length;a++){var s=!1;n={};var u=r[a],l=u.data;if(l.length===i.length||"*"===l[l.length-1]){s=!0,o=u.app,n={};for(var p=0;p<l.length;p++){var c=l[p];if(c.dynamic)n[c.name]=i[p];else if(c.name!==i[p]&&"*"!==c.name){s=!1;break}}}if(s){o=u.app;break}n={},o=""}return"home"===t&&(t=""),{params:n,app:o,url:t}},t.prototype.addMapping=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw"Invalid arguments exception";for(var n=this.mapping,r=this.parseUrl(t),i=0;n>i;i++){var o=n[i].data,a=o.length===r.length;if(a)for(var s=0;s<o.length;s++){var u=o[s],l=r[s];if(!u.dynamic&&!l.dynamic&&u.name!==l.name){a=!1;break}}if(a)throw"Can't put two items with same request mapping: "+t}n.push({app:e,data:r})},t.prototype.parseUrl=function(t){t=e.removeSlashes(t);for(var n=t.split("/"),r=[],i=0;i<n.length;i++){var o=n[i],a=":"==o[0];a&&(o=o.substring(1)),r.push({name:o,dynamic:a})}return r},t}),Engine.define("AbstractFieldsContainer",["Dom","Text","Textarea","Radio","Select","Checkbox","Validation","Password","Word"],function(){function e(e,r,i){var o=[];this.fields={},this.word=i.wordKey?n.create(i.wordKey):null,this.model=e,this.containerMeta=i,r||(r={}),this.meta=r;for(var a in e)if(e.hasOwnProperty(a)){var s,u=e[a],l=null,p=r[a];if(p!==!1){if(p){if(p.ignore)continue;s=p.render?"function"==typeof p.render?p.render(this.onChange,a,u):p.render:this.buildInput(a,u,p);var c=["function"==typeof p.contentBefore?p.contentBefore(a,u):p.contentBefore,s.container,"function"==typeof p.contentAfter?p.contentAfter(a,u):p.contentAfter];if(p.wrapper){var f=p.wrapper;"function"==typeof f?o.push(f(c,a,u)):(t.append(f,c),-1===o.indexOf(f)&&o.push(f))}else o=o.concat(c);l=p.wordKey||null}else s=this.buildInput(a,u,null),o.push(s.container);i.wordKey&&s.label&&this.word(l||"label_"+a,s.label),this.fields[a]=s
}}this.container=this.createContainer(),t.append(this.container,o)}var t=Engine.require("Dom"),n=Engine.require("Word"),r=Engine.require("Text"),i=Engine.require("Radio"),o=Engine.require("Select"),a=Engine.require("Checkbox"),s=Engine.require("Password"),u=Engine.require("Textarea"),l=Engine.require("Validation");return e.resolvers=[function(e,t,n){return"select"===n||e.options&&e.options.length>3?new o(e):null},function(e,t,n){return"radio"===n||e.options&&e.options.length>3?new i(e):null},function(e,t,n){return"checkbox"===n||"boolean"==typeof e.value?new a(e):null},function(e,t,n){return"password"===n||"string"==typeof e.name&&e.name.toLowerCase().indexOf("pass")>-1?new s(e):null},function(e,t,n){return"textarea"===n||"string"==typeof e.value&&(e.value.indexOf("\n")>-1||e.value.length>40)?new u(e):null},function(e,t,n){return"text"===n||"object"!=typeof e.value?new r(e):null}],e.prototype.validateField=function(t){var n=this.meta[t],r=this.fields[t];if(r instanceof e)return r.validate();if(!n||n.ignore===!0)return!0;var i=this.model[t];if(n.removeErrors?n.removeErrors():r.removeErrors&&r.removeErrors(),n.validations){var o=l.validate(i,n.validations);if(o.length>0){var a=this.findErrorMessages(n,o);if(n.addError)n.addError(a);else if(r.addError){var s=r.addError(a);if(this.word)for(var u in s)if(s.hasOwnProperty(u)){var p,c=s[u];n.wordErrorKey&&(p="string"==typeof n.wordErrorKey?n.wordErrorKey:n.wordErrorKey[u]),this.word(p||"error_"+t,c)}}return!1}return!0}return!0},e.prototype.validate=function(){if(this.meta){var e=!0;for(var t in this.meta)if(this.meta.hasOwnProperty(t)){var n=this.validateField(t);e&&!n&&(e=!1)}return e}return!0},e.prototype.findErrorMessages=function(e,t){for(var n={},r=0;r<t.length;r++){var i=t[r];n[i]=e&&"string"==typeof e.errorMessages?e.errorMessages:e&&e.errorMessages&&void 0!==e.errorMessages[i]?e.errorMessages[i]:void 0!==l.messages[i]?l.messages[i]:l.messages["default"]}return n},e.prototype.onChange=function(e,t){this.model[e]=t,this.validateField(e)},e.prototype.buildInput=function(t,n,r){var i=this,o=null,a=null,s={name:t,value:n},u=null;r&&(a=r.listeners,s.options=r.options||null,s.label=r.label||null,r.label===!1&&(s.noLabel=!0),u=r.type||null);var l=null,p=null;if(a){"function"==typeof a&&(a={onchange:a});for(var c in a)if(a.hasOwnProperty(c)){var f=c.toLowerCase(),d=a[c];"onchange"===f||"change"===f?l=d:"onkeyup"===f||"keyup"===f?p=d:s[c]=d}}s.onchange=function(e){i.onChange(t,o.getValue()),l&&l(e)},s.onkeyup=function(e){i.onChange(t,o.getValue()),p&&p(e)};for(var h=0;h<e.resolvers.length&&(o=e.resolvers[h](s,r,u),null==o);h++);if(null!=o)return o;throw"Can't instantiate field for "-s.value},e}),Engine.define("GenericFieldset",["Dom","AbstractFieldsContainer"],function(){function e(){n.apply(this,arguments)}var t=Engine.require("Dom"),n=Engine.require("AbstractFieldsContainer");return e.prototype=Object.create(n.prototype),n.resolvers.unshift(function(t,n,r){return"fieldset"===r||"object"==typeof t.value?new e(t.value,n.metaData,n):null}),e.prototype.createContainer=function(){var e={},n=this.containerMeta||{};n.id&&(e.id=n.id),n.class&&(e.class=n.class);var r;return n.legend===!1?r=null:"string"==typeof n.legend&&(r=t.el("legend",null,n.legend)),this.word&&n.wordLegend?this.word(n.wordLegend,r):!r&&n.legend&&(r=n.legend),t.el("fieldset",e,r)},e}),Engine.define("GenericForm",["AbstractFieldsContainer","Dom"],function(){function e(r,i,o){n.apply(this,e.prepareArguments(r,i,o)),o||(o=i),this.submit=o.submitButton===!1?null:o.submitButton?o.submitButton:t.el("div",null,t.el("input",{type:"submit","class":"primary",value:"Submit"})),t.append(this.container,this.submit)}var t=Engine.require("Dom"),n=Engine.require("AbstractFieldsContainer");return e.prototype=Object.create(n.prototype),e.prepareArguments=function(e,t,n){if(void 0===n&&(n=t,t=null),"function"==typeof n&&(n={onSubmit:n}),!n.onSubmit)throw"onSubmit is required for generic form";return[e,t,n]},e.prototype.createContainer=function(){var e=this,n={onsubmit:function(t){e.onSubmit(t)}},r=this.containerMeta||{};r.class&&(n.class=r.class),r.id&&(n.id=r.id);var i=null;return"string"==typeof r.title?i=t.el("h3",null,r.title):r.title&&(i=r.title),t.el("form",n,i)},e.prototype.onSubmit=function(e){e&&e.preventDefault(),this.validate()&&this.containerMeta.onSubmit(this.model)},e}),Engine.define("Dispatcher",["Dom","UrlResolver","UrlUtils"],function(){function e(e,o,s,u){var l=e.applications[s];if(!l)throw"Undefined application "+s;var p=function(){e.context&&(e.context.request=o)},c=function(e){var t=r(e),n=a.getPath();if(o.url!==n){var i=document.location.hash;this.history.pushState({},t,"/"+(o.url||"")+(i||""))}};if(e.applicationName===s&&e.activeApplication.canStay){p(),c(e.activeApplication);var f=e.activeApplication.canStay();if(f!==!1)return}n(e,s),p();var d=t(e,l);c(d),i(e,d,o.params,u,s)}function t(e,t){var n;return"function"==typeof t?n=new t(e.context):(n=t,n.init&&n.init(e.context)),n}function n(e){var t=e.activeApplication;if(t){var n=e.applicationName;e.fireEvent("beforeClose",n),t.beforeClose&&t.beforeClose(),e.app.innerHTML="",t.afterClose&&t.afterClose(),e.fireEvent("afterClose",n)}}function r(e){return e.getTitle?e.getTitle():e.TITLE||e.title?e.TITLE||e.title:""}function i(e,t,n,r,i){e.fireEvent("beforeOpen",i),e.activeApplication=t,e.applicationName=i,t.beforeOpen&&t.beforeOpen(n,r),t.container&&e.app.appendChild(t.container),t.afterOpen&&t.afterOpen(n,r),e.fireEvent("afterOpen",i)}var o=Engine.require("Dom"),a=Engine.require("UrlUtils"),s=Engine.require("UrlResolver"),u=function(e,t,n){this.app="string"==typeof e?o.id(e):e,this.context=t||{},this.applications={},this.applicationName=null,this.activeApplication=null,this.history=history,this.urlResolver=n||new s;var r=this,i=function(){if(r.urlResolver){var e=a.getPath();r.placeApplication(e)}};o.addListeners({onpopstate:i}),this.events=null,t.dispatcher=this};return u.prototype.addMapping=function(e,t){this.urlResolver.addMapping(e,t)},u.prototype.addListener=function(e,t){switch(t||(t=e,e="afterOpen"),e){case"beforeOpen":case"afterOpen":case"beforeClose":case"afterClose":break;default:throw"Unknown event: "+e}null===this.events&&(this.events={}),this.events[e]||(this.events[e]=[]),this.events[e].push(t)},u.prototype.placeApplication=function(t,n){t||(t=a.getPath());var r,i=this,o=i.urlResolver.resolve(t);r=o.app?o.app:"Page404";var s=i.applications[r];s?e(i,o,r,n):Engine.load(r,function(){i.applications[r]=Engine.require(r),e(i,o,r,n)})},u.prototype.fireEvent=function(e,t){if(null!==this.events&&this.events[e])for(var n=this.events[e],r=0;r<n.length;r++)n[r](t)},u});